name: Build and Deploy AzUrlShortener # Optionaler Name für den Workflow

on: # Definiert, wann der Workflow starten soll
  push:
    branches:
      - main
  # ... (andere Trigger)

env: # Globale Umgebungsvariablen
  AZURE_ENV_NAME: AzUrlShortener # Dein AZD-Umgebungsname
  # ... (andere globale Variablen)

jobs: # <-- DIESE ZEILE IST ENTSCHEIDEND
  build: # Der erste Job (den hattest du vorher schon)
    runs-on: ubuntu-latest
    steps:
      # ... (alle Schritte für den Build-Prozess) ...

  deploy: # Dein zweiter Job, KORREKT EINGERÜCKT unter 'jobs:'
    runs-on: ubuntu-latest
    needs: build # Abhängigkeit vom build-Job
    environment: Production
    steps:
      # --- Alle deine Deploy-Schritte kommen hier rein ---
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Azure Developer CLI
        # ... (Rest deiner Deploy-Schritte) ...

      - name: Login azd with Service Principal (Direct Secrets)
        # ...

      - name: Check AZD Login Status
        # ...

      - name: Initialize AZD Environment
        # ...

      - name: Set AZD Environment Subscription
        # ...

      - name: Deploy services using AZD
        # ...

      - name: Azure Logout (AZD)
        # ...
